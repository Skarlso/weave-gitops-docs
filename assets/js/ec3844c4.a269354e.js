(self.webpackChunkweave_gitops_docs=self.webpackChunkweave_gitops_docs||[]).push([[2443],{3905:function(e,t,a){"use strict";a.d(t,{Zo:function(){return p},kt:function(){return m}});var r=a(7294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var l=r.createContext({}),c=function(e){var t=r.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},p=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,o=e.originalType,l=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),d=c(a),m=n,g=d["".concat(l,".").concat(m)]||d[m]||u[m]||o;return a?r.createElement(g,s(s({ref:t},p),{},{components:a})):r.createElement(g,s({ref:t},p))}));function m(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=a.length,s=new Array(o);s[0]=d;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:n,s[1]=i;for(var c=2;c<o;c++)s[c]=a[c];return r.createElement.apply(null,s)}return r.createElement.apply(null,a)}d.displayName="MDXCreateElement"},9443:function(e,t,a){"use strict";var r=(0,a(7294).createContext)(void 0);t.Z=r},1615:function(e,t,a){"use strict";a.r(t),a.d(t,{contentTitle:function(){return k},default:function(){return w},frontMatter:function(){return f},metadata:function(){return v},toc:function(){return b}});var r=a(2122),n=a(9756),o=a(7294),s=a(3905),i=a(9443);var l=function(){var e=(0,o.useContext)(i.Z);if(null==e)throw new Error('"useUserPreferencesContext" is used outside of "Layout" component.');return e},c=a(6010),p="tabItem_1uMI",u="tabItemActive_2DSg";var d=37,m=39;var g=function(e){var t=e.lazy,a=e.block,r=e.defaultValue,n=e.values,s=e.groupId,i=e.className,g=l(),h=g.tabGroupChoices,f=g.setTabGroupChoices,k=(0,o.useState)(r),v=k[0],b=k[1],y=o.Children.toArray(e.children),w=[];if(null!=s){var N=h[s];null!=N&&N!==v&&n.some((function(e){return e.value===N}))&&b(N)}var C=function(e){var t=e.currentTarget,a=w.indexOf(t),r=n[a].value;b(r),null!=s&&(f(s,r),setTimeout((function(){var e,a,r,n,o,s,i,l;(e=t.getBoundingClientRect(),a=e.top,r=e.left,n=e.bottom,o=e.right,s=window,i=s.innerHeight,l=s.innerWidth,a>=0&&o<=l&&n<=i&&r>=0)||(t.scrollIntoView({block:"center",behavior:"smooth"}),t.classList.add(u),setTimeout((function(){return t.classList.remove(u)}),2e3))}),150))},T=function(e){var t,a;switch(e.keyCode){case m:var r=w.indexOf(e.target)+1;a=w[r]||w[0];break;case d:var n=w.indexOf(e.target)-1;a=w[n]||w[w.length-1]}null==(t=a)||t.focus()};return o.createElement("div",{className:"tabs-container"},o.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,c.Z)("tabs",{"tabs--block":a},i)},n.map((function(e){var t=e.value,a=e.label;return o.createElement("li",{role:"tab",tabIndex:v===t?0:-1,"aria-selected":v===t,className:(0,c.Z)("tabs__item",p,{"tabs__item--active":v===t}),key:t,ref:function(e){return w.push(e)},onKeyDown:T,onFocus:C,onClick:C},a)}))),t?(0,o.cloneElement)(y.filter((function(e){return e.props.value===v}))[0],{className:"margin-vert--md"}):o.createElement("div",{className:"margin-vert--md"},y.map((function(e,t){return(0,o.cloneElement)(e,{key:t,hidden:e.props.value!==v})}))))};var h=function(e){var t=e.children,a=e.hidden,r=e.className;return o.createElement("div",{role:"tabpanel",hidden:a,className:r},t)},f={title:"Upgrading",sidebar_position:0},k=void 0,v={unversionedId:"enterprise/upgrading",id:"enterprise/upgrading",isDocsHomePage:!1,title:"Upgrading",description:"How to: Upgrade to Weave Gitops Enterprise",source:"@site/docs/enterprise/upgrading.mdx",sourceDirName:"enterprise",slug:"/enterprise/upgrading",permalink:"/docs/next/enterprise/upgrading",editUrl:"https://github.com/weaveworks/weave-gitops-docs/edit/main/docs/enterprise/upgrading.mdx",version:"current",sidebarPosition:0,frontMatter:{title:"Upgrading",sidebar_position:0},sidebar:"tutorialSidebar",previous:{title:"Introduction",permalink:"/docs/next/enterprise/intro"}},b=[{value:"How to: Upgrade to Weave Gitops Enterprise",id:"how-to-upgrade-to-weave-gitops-enterprise",children:[{value:"2. Choosing a database",id:"2-choosing-a-database",children:[]},{value:"3. Creating a secret for docker repository",id:"3-creating-a-secret-for-docker-repository",children:[]},{value:"4. Create a secret for creating pull requests on your git provider",id:"4-create-a-secret-for-creating-pull-requests-on-your-git-provider",children:[]},{value:"5. Determining the public IP address of the worker nodes",id:"5-determining-the-public-ip-address-of-the-worker-nodes",children:[]},{value:"6. Installing the Helm chart",id:"6-installing-the-helm-chart",children:[]},{value:"7. Checking that WGE is installed (optional)",id:"7-checking-that-wge-is-installed-optional",children:[]}]},{value:"How to: Install the MCCP CLI",id:"how-to-install-the-mccp-cli",children:[]}],y={toc:b};function w(e){var t=e.components,a=(0,n.Z)(e,["components"]);return(0,s.kt)("wrapper",(0,r.Z)({},y,a,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("h2",{id:"how-to-upgrade-to-weave-gitops-enterprise"},"How to: Upgrade to Weave Gitops Enterprise"),(0,s.kt)("p",null,"Upgrading requires we:"),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},"Already have Weave GitOps ",(0,s.kt)("a",{parentName:"li",href:"/docs/next/getting-started"},"installed on the cluster")),(0,s.kt)("li",{parentName:"ol"},"Choose a database"),(0,s.kt)("li",{parentName:"ol"},"Create a secret for docker repository"),(0,s.kt)("li",{parentName:"ol"},"Create a secret for creating pull requests on your git provider"),(0,s.kt)("li",{parentName:"ol"},"Determine the public IP address of the worker nodes"),(0,s.kt)("li",{parentName:"ol"},"Install the helm chart"),(0,s.kt)("li",{parentName:"ol"},"Check that Weave Gitops Enterprise has been installed (optional)")),(0,s.kt)("h3",{id:"2-choosing-a-database"},"2. Choosing a database"),(0,s.kt)("p",null,"WGE stores incoming data from the connected clusters to a relational database. It supports ",(0,s.kt)("strong",{parentName:"p"},"SQLite")," and ",(0,s.kt)("strong",{parentName:"p"},"PostgreSQL"),"."),(0,s.kt)(g,{groupId:"database-systems",values:[{label:"SQLite on a persistent volume",value:"sqlite-persistent-volume"},{label:"PostgreSQL",value:"postgres"}],mdxType:"Tabs"},(0,s.kt)(h,{value:"sqlite-persistent-volume",mdxType:"TabItem"},(0,s.kt)("p",null,"If your cluster supports persistent volume storage and has a storage class defined, you can use it to request a persistent volume for the SQLite database file. The exact details of the persistent volume request vary by cluster type and the supported volume types. The following manifest is an example of a configuration of a ",(0,s.kt)("inlineCode",{parentName:"p"},"PersistentVolumeClaim"),":"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: wge-volume\n  namespace: wego-system\nspec:\n  storageClassName: default\n  resources:\n    requests:\n      storage: 100G\n  volumeMode: Filesystem\n  accessModes:\n    - ReadWriteOnce\n"))),(0,s.kt)(h,{value:"postgres",mdxType:"TabItem"},(0,s.kt)("p",null,"Using a PostgreSQL database does not require any additional setup on the cluster side. The following details are however needed in order to connect:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"Database server hostname"),(0,s.kt)("li",{parentName:"ul"},"Database name"),(0,s.kt)("li",{parentName:"ul"},"Database user - The database user requires admin privileges on the database server as it will automatically create the necessary schema."),(0,s.kt)("li",{parentName:"ul"},"Database password")),(0,s.kt)("p",null,"The database credentials (user and password) need to be provided separately, before\ninstalling the chart, as a secret. Run the following command to create a secret:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"$ kubectl create secret generic wge-db-credentials \\\n    --namespace wego-system \\\n    --from-literal=username=<database-user> \\\n    --from-literal=password=<database-password>\n")))),(0,s.kt)("h3",{id:"3-creating-a-secret-for-docker-repository"},"3. Creating a secret for docker repository"),(0,s.kt)("p",null,"Create a secret that contains your docker repository credentials. This secret will be used by Kubernetes during deployment in order to pull down the WGE images. You can find instructions on how to generate this secret ",(0,s.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/"},"here"),"."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"$ kubectl create secret docker-registry \\\n  --namespace wego-system docker-io-pull-secret \\\n  --docker-username=<your-docker-username> \\\n  --docker-password=<your-docker-password>\n")),(0,s.kt)("p",null,"If you use a secrets management solution such as Sealed Secrets follow their instructions on how to create a new secret."),(0,s.kt)("p",null,"Take note of the secret name as you will need to supply it later when installing the chart."),(0,s.kt)("h3",{id:"4-create-a-secret-for-creating-pull-requests-on-your-git-provider"},"4. Create a secret for creating pull requests on your git provider"),(0,s.kt)("p",null,"A Personal Access Token is required for the WGE to create pull requests for new clusters. These tokens need certain permissions (scopes) set. For"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"GitHub: ",(0,s.kt)("inlineCode",{parentName:"li"},"repo")),(0,s.kt)("li",{parentName:"ul"},"GitLab: ",(0,s.kt)("inlineCode",{parentName:"li"},"api"))),(0,s.kt)("p",null,"Save the token in secret called ",(0,s.kt)("inlineCode",{parentName:"p"},"git-provider-credentials"),"."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'kubectl create secret generic git-provider-credentials \\\n  --namespace=wego-system\n  --from-literal="GIT_PROVIDER_TOKEN=$GITHUB_TOKEN"\n')),(0,s.kt)("h3",{id:"5-determining-the-public-ip-address-of-the-worker-nodes"},"5. Determining the public IP address of the worker nodes"),(0,s.kt)("p",null,"You need to determine the public IP address of the worker nodes of your cluster. This IP address is necessary in order to establish connectivity between agents and your WGE instance. The way to determine this depends on your cluster type and provisioning method. Take note of that IP address as you will need to supply it later when installing the chart."),(0,s.kt)(g,{groupId:"agent-ingress",values:[{label:"kind clusters",value:"kind-clusters"},{label:"Other cloud providers",value:"other-clusters"}],mdxType:"Tabs"},(0,s.kt)(h,{value:"kind-clusters",mdxType:"TabItem"},(0,s.kt)("p",null,"Get the local IP for kind:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"export INGRESS_ADDRESS=$(ipconfig getifaddr en0)\n"))),(0,s.kt)(h,{value:"other-clusters",mdxType:"TabItem"},(0,s.kt)("p",null,"For other cluster providers you'll have to configure the ingress around what they provide."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"export INGRESS_ADDRESS=wge.example.com\n")))),(0,s.kt)("h3",{id:"6-installing-the-helm-chart"},"6. Installing the Helm chart"),(0,s.kt)("p",null,"Before installing the chart, you need to add the Helm chart repository and then update its local cache. Run the following commands:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'$ helm repo add wkpv3 https://s3.us-east-1.amazonaws.com/weaveworks-wkp/charts-v3\n  "wkpv3" has been added to your repositories\n$ helm repo update\n  Hang tight while we grab the latest from your chart repositories...\n  ...Successfully got an update from the "wkpv3" chart repository\n  Update Complete. \u2388Happy Helming!\u2388\n')),(0,s.kt)("p",null,"Finally install the Helm chart to the target namespace by executing the following command using the Helm CLI (>= ",(0,s.kt)("inlineCode",{parentName:"p"},"v3.5.4"),")."),(0,s.kt)(g,{groupId:"database-systems",values:[{label:"SQLite on a persistent volume",value:"sqlite-persistent-volume"},{label:"PostgreSQL",value:"postgres"}],mdxType:"Tabs"},(0,s.kt)(h,{value:"sqlite-persistent-volume",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'$ helm install mccp wkpv3/mccp \\\n    --version <chart-version> \\\n    --namespace wego-system \\\n    --set "imagePullSecrets[0].name=<secret-containing-docker-config>" \\\n    --set "dbConfig.databaseType=sqlite" \\\n    --set "sqliteConfig.persistentVolumeClaim=true" \\\n    --set "agentTemplate.natsURL=$INGRESS_ADDRESS:<exposed-port-for-nats>" \\\n    --set "nats.client.service.nodePort=<exposed-port-for-nats>" \\\n    --set "wkp-ui.image.pullSecrets[0]=<secret-containing-docker-config>" \\\n    --set "config.capi.repositoryURL=https://github.com/example/management-repo" \\\n    --set "config.capi.baseBranch=main"\n'))),(0,s.kt)(h,{value:"postgres",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'$ helm install mccp wkpv3/mccp \\\n    --version <chart-version> \\\n    --namespace wego-system \\\n    --set "imagePullSecrets[0].name=<secret-containing-docker-config>" \\\n    --set "dbConfig.databaseType=postgres" \\\n    --set "dbConfig.databaseURI=<database-server-hostname>" \\\n    --set "postgresConfig.databaseName=<database-name>" \\\n    --set "agentTemplate.natsURL=$INGRESS_ADDRESS:<exposed-port-for-nats>" \\\n    --set "nats.client.service.nodePort=<exposed-port-for-nats>" \\\n    --set "wkp-ui.image.pullSecrets[0]=<secret-containing-docker-config>" \\\n    --set "config.capi.repositoryURL=https://github.com/example/management-repo" \\\n    --set "config.capi.baseBranch=main"\n')),(0,s.kt)("p",null,"By default, connections to PostgreSQL will use port 5432."))),(0,s.kt)("h3",{id:"7-checking-that-wge-is-installed-optional"},"7. Checking that WGE is installed (optional)"),(0,s.kt)("p",null,"You should now be able to load the WGE UI by running the following command:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"$ kubectl port-forward --namespace wego-system deployments.apps/mccp-nginx-ingress-controller 8000:80\n")),(0,s.kt)("p",null,"The WGE UI should now be accessible at ",(0,s.kt)("inlineCode",{parentName:"p"},"http://localhost:8000"),"."),(0,s.kt)("h2",{id:"how-to-install-the-mccp-cli"},"How to: Install the MCCP CLI"),(0,s.kt)("p",null,"The MCCP CLI allows you to interact with Weave GitOps Enterprise management clusters. You can use ",(0,s.kt)("inlineCode",{parentName:"p"},"mccp")," to manage the lifecycle of your infrastructure declaratively using GitOps. The latest version of the MCCP CLI is available in the following links:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://weaveworks-wkp.s3.amazonaws.com/mccp-master-linux-amd64"},"Linux")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://weaveworks-wkp.s3.amazonaws.com/mccp-master-darwin-amd64"},"macOS"))))}w.isMDXComponent=!0},6010:function(e,t,a){"use strict";function r(e){var t,a,n="";if("string"==typeof e||"number"==typeof e)n+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(a=r(e[t]))&&(n&&(n+=" "),n+=a);else for(t in e)e[t]&&(n&&(n+=" "),n+=t);return n}function n(){for(var e,t,a=0,n="";a<arguments.length;)(e=arguments[a++])&&(t=r(e))&&(n&&(n+=" "),n+=t);return n}a.d(t,{Z:function(){return n}})}}]);