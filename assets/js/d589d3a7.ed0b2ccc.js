(self.webpackChunkweave_gitops_docs=self.webpackChunkweave_gitops_docs||[]).push([[162],{601:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return r},metadata:function(){return s},toc:function(){return l},default:function(){return p}});var i=n(2122),o=n(9756),a=(n(7294),n(3905)),r={sidebar_position:2},s={unversionedId:"getting-started",id:"getting-started",isDocsHomePage:!1,title:"Getting Started",description:"Let's get an app deployed with Weave Gitops.",source:"@site/docs/getting-started.md",sourceDirName:".",slug:"/getting-started",permalink:"/docs/getting-started",editUrl:"https://github.com/weaveworks/weave-gitops-docs/edit/master/website/docs/getting-started.md",version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Installating the CLI",permalink:"/docs/installation"},next:{title:"CLI Reference",permalink:"/docs/cli-reference"}},l=[{value:"Overview",id:"overview",children:[]},{value:"Pre-requisites",id:"pre-requisites",children:[{value:"Github setup",id:"github-setup",children:[]},{value:"Install the CLI",id:"install-the-cli",children:[]}]},{value:"Getting Started Steps",id:"getting-started-steps",children:[]}],c={toc:l};function p(e){var t=e.components,n=(0,o.Z)(e,["components"]);return(0,a.kt)("wrapper",(0,i.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Let's get an app deployed with ",(0,a.kt)("strong",{parentName:"p"},"Weave Gitops"),"."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"This is Work In Progress")),(0,a.kt)("h3",{id:"overview"},"Overview"),(0,a.kt)("p",null,"In this short guide, we will see how to get a simple workload running in a cluster using GitOps, and then make a change to that deployment and see it updated automatically\nvia GitOps. Further guides will then show how to move that workload into staging and/or production. "),(0,a.kt)("h2",{id:"pre-requisites"},"Pre-requisites"),(0,a.kt)("p",null,"At the moment, Weave GitOps supports ",(0,a.kt)("a",{parentName:"p",href:"https://github.com"},"Github"),". ",(0,a.kt)("a",{parentName:"p",href:"https://gitlab.com"},"Gitlab")," and other Git providers are coming soon."),(0,a.kt)("p",null,"To get this working you need:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"A Github account "),(0,a.kt)("li",{parentName:"ol"},"A Github token and SSH key"),(0,a.kt)("li",{parentName:"ol"},"kubectl installed "),(0,a.kt)("li",{parentName:"ol"},"A development Kubernetes cluster (e.g. kind)")),(0,a.kt)("h3",{id:"github-setup"},"Github setup"),(0,a.kt)("p",null,"Please follow the ",(0,a.kt)("a",{parentName:"p",href:"https://docs.github.com/en/github/authenticating-to-github/connecting-to-github-with-ssh"},"Github SSH key setup guide")," if you don't already have an SSH key for Github."),(0,a.kt)("p",null,"You also need a Github Token with ",(0,a.kt)("inlineCode",{parentName:"p"},"repo")," access. Please follow the ",(0,a.kt)("a",{parentName:"p",href:"https://docs.github.com/en/github/authenticating-to-github/keeping-your-account-and-data-secure/creating-a-personal-access-token"},"Github guide")),(0,a.kt)("p",null,"Make sure that the token is in your environment as ",(0,a.kt)("inlineCode",{parentName:"p"},"GITHUB_TOKEN")),(0,a.kt)("h3",{id:"install-the-cli"},"Install the CLI"),(0,a.kt)("p",null,"Please follow the instructions in the  ",(0,a.kt)("a",{parentName:"p",href:"/docs/installation"},"CLI installation page")," to install the command-line tool."),(0,a.kt)("h2",{id:"getting-started-steps"},"Getting Started Steps"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"If necessary create a kind cluster:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"kind create cluster\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'Creating cluster "kind" ...\n \u2713 Ensuring node image (kindest/node:v1.20.2) \ud83d\uddbc\n \u2713 Preparing nodes \ud83d\udce6\n \u2713 Writing configuration \ud83d\udcdc\n \u2713 Starting control-plane \ud83d\udd79\ufe0f\n \u2713 Installing CNI \ud83d\udd0c\n \u2713 Installing StorageClass \ud83d\udcbe\nSet kubectl context to "kind-kind"\nYou can now use your cluster with:\n\nkubectl cluster-info --context kind-kind\n\nHave a nice day! \ud83d\udc4b\n')),(0,a.kt)("ol",{start:2},(0,a.kt)("li",{parentName:"ol"},"Install Weave GitOps into the cluster")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"wego install | kubectl apply -f -\n")),(0,a.kt)("p",null,"You should see:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"namespace/flux-system created\nnamespace/wego-system created\ncustomresourcedefinition.apiextensions.k8s.io/alerts.notification.toolkit.fluxcd.io created\ncustomresourcedefinition.apiextensions.k8s.io/buckets.source.toolkit.fluxcd.io created\ncustomresourcedefinition.apiextensions.k8s.io/gitrepositories.source.toolkit.fluxcd.io created\ncustomresourcedefinition.apiextensions.k8s.io/helmcharts.source.toolkit.fluxcd.io created\ncustomresourcedefinition.apiextensions.k8s.io/helmreleases.helm.toolkit.fluxcd.io created\ncustomresourcedefinition.apiextensions.k8s.io/helmrepositories.source.toolkit.fluxcd.io created\ncustomresourcedefinition.apiextensions.k8s.io/kustomizations.kustomize.toolkit.fluxcd.io created\ncustomresourcedefinition.apiextensions.k8s.io/providers.notification.toolkit.fluxcd.io created\ncustomresourcedefinition.apiextensions.k8s.io/receivers.notification.toolkit.fluxcd.io created\nserviceaccount/helm-controller created\nserviceaccount/kustomize-controller created\nserviceaccount/notification-controller created\nserviceaccount/source-controller created\nclusterrole.rbac.authorization.k8s.io/crd-controller-wego-system created\nclusterrolebinding.rbac.authorization.k8s.io/cluster-reconciler-wego-system created\nclusterrolebinding.rbac.authorization.k8s.io/crd-controller-wego-system created\nservice/notification-controller created\nservice/source-controller created\nservice/webhook-receiver created\ndeployment.apps/helm-controller created\ndeployment.apps/kustomize-controller created\ndeployment.apps/notification-controller created\ndeployment.apps/source-controller created\nnetworkpolicy.networking.k8s.io/allow-egress created\nnetworkpolicy.networking.k8s.io/allow-scraping created\nnetworkpolicy.networking.k8s.io/allow-webhooks created\ncustomresourcedefinition.apiextensions.k8s.io/apps.wego.weave.works created\n")),(0,a.kt)("ol",{start:4},(0,a.kt)("li",{parentName:"ol"},"Wait for Weave GitOps controllers to come online:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"kubectl get all --namespace wego-system\n")),(0,a.kt)("p",null,"You need to wait until all the controllers are running, e.g.:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"NAME                                       READY   STATUS    RESTARTS   AGE\nhelm-controller-69667f94bc-w5kjv           1/1     Running   0          59s\nkustomize-controller-6977b8cdd4-m5blk      1/1     Running   0          59s\nnotification-controller-5c4d48f476-ns4rd   1/1     Running   0          59s\nsource-controller-b4b88948f-hqqbm          1/1     Running   0          59s\n")),(0,a.kt)("ol",{start:5},(0,a.kt)("li",{parentName:"ol"},"Fork the nginx repo:\nFork the following repository on Github:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"https://github.com/pzfreo/nginx\n")),(0,a.kt)("ol",{start:6},(0,a.kt)("li",{parentName:"ol"},"Clone the fork using SSH:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"git clone git@github.com:<yr-org-goes-here>/nginx.git\n")),(0,a.kt)("p",null,"(replace the ",(0,a.kt)("inlineCode",{parentName:"p"},"<yr-org-goes-here>")," with your own information)"),(0,a.kt)("ol",{start:7},(0,a.kt)("li",{parentName:"ol"},"Configure Weave GitOps to deploy the repository")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"cd nginx\nwego add . --private-key=<created private key file>\n")),(0,a.kt)("p",null,"You should see something like:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"Updating parameters from environment... using URL: 'ssh://git@github.com/pzfreo/nginx.git' of origin from git config...\n\ndone\n\nChecking cluster status... FluxInstalled\n\nVerifying kind-kind-wego repository exists...\ncould not check repository exists: GITHUB_TOKEN not set in environment\n~/repos/pzfreo/nginx$ export GITHUB_TOKEN=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\n~/repos/pzfreo/nginx$ wego app add . --private-key=/Users/paul/.ssh/wego\nUpdating parameters from environment... using URL: 'ssh://git@github.com/pzfreo/nginx.git' of origin from git config...\n\ndone\n\nChecking cluster status... FluxInstalled\n\nVerifying kind-kind-wego repository exists...\nCreating kind-kind-wego repository...\nCloning ssh://git@github.com/pzfreo/kind-kind-wego.git...\nApplying wego platform resources...\n\u271a deploy key: ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIK9/sPRvz8t5sExOC/PAdiVKIX3g3rwh0q5f24djQ2T0\n\n\u25ba secret 'wego' created in 'wego-system' namespace\n---\napiVersion: source.toolkit.fluxcd.io/v1beta1\nkind: GitRepository\nmetadata:\n  name: wego\n  namespace: wego-system\nspec:\n  interval: 30s\n  ref:\n    branch: main\n  secretRef:\n    name: wego\n  url: ssh://git@github.com/pzfreo/kind-kind-wego\n\n---\napiVersion: kustomize.toolkit.fluxcd.io/v1beta1\nkind: Kustomization\nmetadata:\n  name: wego\n  namespace: wego-system\nspec:\n  interval: 5m0s\n  path: ./\n  prune: true\n  sourceRef:\n    kind: GitRepository\n    name: wego\n  validation: client\n\n\u271a deploy key: ssh-ed25519 \n\n\u25ba secret 'kind-kind-wego-nginx' created in 'wego-system' namespace\n---\napiVersion: source.toolkit.fluxcd.io/v1beta1\nkind: GitRepository\nmetadata:\n  name: kind-kind-wego-nginx\n  namespace: wego-system\nspec:\n  interval: 30s\n  ref:\n    branch: main\n  secretRef:\n    name: kind-kind-wego-nginx\n  url: ssh://git@github.com/pzfreo/nginx.git\n\n---\napiVersion: kustomize.toolkit.fluxcd.io/v1beta1\nkind: Kustomization\nmetadata:\n  name: kind-kind-wego-nginx\n  namespace: wego-system\nspec:\n  interval: 5m0s\n  path: ./\n  prune: true\n  sourceRef:\n    kind: GitRepository\n    name: kind-kind-wego-nginx\n  validation: client\n\nCommiting and pushing wego resources for application...\nPushing app manifests to repository\nSuccessfully added kind-kind-wego-nginx to the repository.\n")),(0,a.kt)("ol",{start:8},(0,a.kt)("li",{parentName:"ol"},'This will have created a new "wego repository"')),(0,a.kt)("p",null,'By default, Weave GitOps creates a new repository in which it deploys the "GitOps Automation" configuration.\nThis will be created in your Github account and if you used kind will be called\n',(0,a.kt)("inlineCode",{parentName:"p"},"kind-kind-wego")," "),(0,a.kt)("p",null,"Inside this repository you will find a folder called ",(0,a.kt)("inlineCode",{parentName:"p"},"apps"),", and it will have a folder called something like ",(0,a.kt)("inlineCode",{parentName:"p"},"kind-kind-wego-nginx"),". "),(0,a.kt)("p",null,"All of these are defaults that are automatically generated by ",(0,a.kt)("inlineCode",{parentName:"p"},"wego")," and can be specified in the ",(0,a.kt)("inlineCode",{parentName:"p"},"wego app add")," command"),(0,a.kt)("p",null,"In that folder you will find a file ",(0,a.kt)("inlineCode",{parentName:"p"},"app.yaml")," that defines the application:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: wego.weave.works/v1alpha1\nkind: Application\nmetadata:\n  name: kind-kind-wego-nginx\nspec:\n  path: ./\n  url: ssh://git@github.com/pzfreo/nginx.git\n")),(0,a.kt)("ol",{start:8},(0,a.kt)("li",{parentName:"ol"},"Wait for the workload to show up in the cluster:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"kubectl get pods --namespace my-nginx\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"NAME                     READY   STATUS    RESTARTS   AGE\nnginx-646c686cd6-5qbjb   1/1     Running   0          3m\nnginx-646c686cd6-lwj44   1/1     Running   0          3m\nnginx-646c686cd6-q8gbs   1/1     Running   0          3m\n")),(0,a.kt)("ol",{start:9},(0,a.kt)("li",{parentName:"ol"},"You can use the ",(0,a.kt)("inlineCode",{parentName:"li"},"wego app status")," command to see the reconciliation:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"wego app status kind-kind-wego-nginx\n")),(0,a.kt)("p",null,"Latest successful deployment time: 2021-06-06T12:00:30Z\nNAMESPACE  \tNAME                              \tREADY\tMESSAGE                                                        \tREVISION                                     \tSUSPENDED\nwego-system\tgitrepository/kind-kind-wego-nginx\tTrue \tFetched revision: main/895ff5532e86ec9bae4863b047fb2d0c1879709b\tmain/895ff5532e86ec9bae4863b047fb2d0c1879709b\tFalse"),(0,a.kt)("p",null,"NAMESPACE  \tNAME                              \tREADY\tMESSAGE                                                        \tREVISION                                     \tSUSPENDED\nwego-system\tkustomization/kind-kind-wego-nginx\tTrue \tApplied revision: main/895ff5532e86ec9bae4863b047fb2d0c1879709b\tmain/895ff5532e86ec9bae4863b047fb2d0c1879709b\tFalse"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"\n10. Try committing an update to the number of replicas to your forked repository:\n```yaml\nspec:\n  replicas: 4\n")),(0,a.kt)("ol",{start:11},(0,a.kt)("li",{parentName:"ol"},"Wait approximately 30s for the reconciliation to take place")),(0,a.kt)("p",null,"You should now see a 4th replica appear:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"kubectl get pods --namespace my-nginx\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"NAME                     READY   STATUS    RESTARTS   AGE\nnginx-646c686cd6-5qbjb   1/1     Running   0          6m\nnginx-646c686cd6-lwj44   1/1     Running   0          6m\nnginx-646c686cd6-q8gbs   1/1     Running   0          6m\nnginx-646c686cd6-whcsw   1/1     Running   0          35s\n")),(0,a.kt)("ol",{start:12},(0,a.kt)("li",{parentName:"ol"},"Congratulations ")),(0,a.kt)("p",null,"You have successfully deployed GitOps! Well done."))}p.isMDXComponent=!0}}]);