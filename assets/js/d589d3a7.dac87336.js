(self.webpackChunkweave_gitops_docs=self.webpackChunkweave_gitops_docs||[]).push([[162],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return c},kt:function(){return m}});var o=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=o.createContext({}),p=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},c=function(e){var t=p(e.components);return o.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=p(n),m=a,k=d["".concat(s,".").concat(m)]||d[m]||u[m]||i;return n?o.createElement(k,r(r({ref:t},c),{},{components:n})):o.createElement(k,r({ref:t},c))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,r=new Array(i);r[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,r[1]=l;for(var p=2;p<i;p++)r[p]=n[p];return o.createElement.apply(null,r)}return o.createElement.apply(null,n)}d.displayName="MDXCreateElement"},601:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return r},metadata:function(){return l},toc:function(){return s},default:function(){return c}});var o=n(2122),a=n(9756),i=(n(7294),n(3905)),r={sidebar_position:2},l={unversionedId:"getting-started",id:"getting-started",isDocsHomePage:!1,title:"Getting Started",description:"Let's get an app deployed with Weave GitOps.",source:"@site/docs/getting-started.md",sourceDirName:".",slug:"/getting-started",permalink:"/docs/getting-started",editUrl:"https://github.com/weaveworks/weave-gitops-docs/edit/master/website/docs/getting-started.md",version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Installing the CLI",permalink:"/docs/installation"},next:{title:"CLI Reference",permalink:"/docs/cli-reference"}},s=[{value:"Overview",id:"overview",children:[]},{value:"Pre-requisites",id:"pre-requisites",children:[{value:"Github setup",id:"github-setup",children:[]},{value:"Install the CLI",id:"install-the-cli",children:[]}]},{value:"Getting Started Steps",id:"getting-started-steps",children:[]}],p={toc:s};function c(e){var t=e.components,n=(0,a.Z)(e,["components"]);return(0,i.kt)("wrapper",(0,o.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Let's get an app deployed with ",(0,i.kt)("strong",{parentName:"p"},"Weave GitOps"),"."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"This is Work In Progress")),(0,i.kt)("h3",{id:"overview"},"Overview"),(0,i.kt)("p",null,"In this short guide, we will see how to get a simple workload running in a cluster using GitOps, and then make a change to that deployment and see it updated automatically\nvia GitOps. Further guides will then show how to move that workload into staging and/or production. "),(0,i.kt)("h2",{id:"pre-requisites"},"Pre-requisites"),(0,i.kt)("p",null,"At the moment, Weave GitOps supports ",(0,i.kt)("a",{parentName:"p",href:"https://github.com"},"Github"),". ",(0,i.kt)("a",{parentName:"p",href:"https://gitlab.com"},"Gitlab")," and other Git providers are coming soon."),(0,i.kt)("p",null,"To get this working you need:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"A Github account "),(0,i.kt)("li",{parentName:"ol"},"A Github token and SSH key"),(0,i.kt)("li",{parentName:"ol"},"kubectl installed "),(0,i.kt)("li",{parentName:"ol"},"A development Kubernetes cluster (e.g. kind)")),(0,i.kt)("h3",{id:"github-setup"},"Github setup"),(0,i.kt)("p",null,'Weave GitOps works in a "pull" mode, which means that the GitOps runtime pulls the cluster configuration from Git. To do this, it needs an SSH key with access to your Github account. This key will be stored in the cluster as a secret, so it is recommended to create a new key for this.\nPlease follow the ',(0,i.kt)("a",{parentName:"p",href:"https://docs.github.com/en/github/authenticating-to-github/connecting-to-github-with-ssh"},"Github SSH key setup guide"),"."),(0,i.kt)("p",null,"You also need a Github Token with ",(0,i.kt)("inlineCode",{parentName:"p"},"repo")," access. Please follow the ",(0,i.kt)("a",{parentName:"p",href:"https://docs.github.com/en/github/authenticating-to-github/keeping-your-account-and-data-secure/creating-a-personal-access-token"},"Github guide")),(0,i.kt)("p",null,"Make sure that the token is in your environment as ",(0,i.kt)("inlineCode",{parentName:"p"},"GITHUB_TOKEN")),(0,i.kt)("h3",{id:"install-the-cli"},"Install the CLI"),(0,i.kt)("p",null,"Please follow the instructions in the  ",(0,i.kt)("a",{parentName:"p",href:"/docs/installation"},"CLI installation page")," to install the command-line tool."),(0,i.kt)("h2",{id:"getting-started-steps"},"Getting Started Steps"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"If necessary create a kind cluster:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-console"},"kind create cluster\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'Creating cluster "kind" ...\n \u2713 Ensuring node image (kindest/node:v1.20.2) \ud83d\uddbc\n \u2713 Preparing nodes \ud83d\udce6\n \u2713 Writing configuration \ud83d\udcdc\n \u2713 Starting control-plane \ud83d\udd79\ufe0f\n \u2713 Installing CNI \ud83d\udd0c\n \u2713 Installing StorageClass \ud83d\udcbe\nSet kubectl context to "kind-kind"\nYou can now use your cluster with:\n\nkubectl cluster-info --context kind-kind\n\nHave a nice day! \ud83d\udc4b\n')),(0,i.kt)("p",null,"You now will have the right ",(0,i.kt)("inlineCode",{parentName:"p"},"kubeconfig")," for the kind cluster."),(0,i.kt)("ol",{start:2},(0,i.kt)("li",{parentName:"ol"},"Install Weave GitOps into the currently active Kubernetes cluster:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-console"},"wego install \n")),(0,i.kt)("p",null,"You should see:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"namespace/flux-system created\nnamespace/wego-system created\ncustomresourcedefinition.apiextensions.k8s.io/alerts.notification.toolkit.fluxcd.io created\ncustomresourcedefinition.apiextensions.k8s.io/buckets.source.toolkit.fluxcd.io created\ncustomresourcedefinition.apiextensions.k8s.io/gitrepositories.source.toolkit.fluxcd.io created\ncustomresourcedefinition.apiextensions.k8s.io/helmcharts.source.toolkit.fluxcd.io created\ncustomresourcedefinition.apiextensions.k8s.io/helmreleases.helm.toolkit.fluxcd.io created\ncustomresourcedefinition.apiextensions.k8s.io/helmrepositories.source.toolkit.fluxcd.io created\ncustomresourcedefinition.apiextensions.k8s.io/kustomizations.kustomize.toolkit.fluxcd.io created\ncustomresourcedefinition.apiextensions.k8s.io/providers.notification.toolkit.fluxcd.io created\ncustomresourcedefinition.apiextensions.k8s.io/receivers.notification.toolkit.fluxcd.io created\nserviceaccount/helm-controller created\nserviceaccount/kustomize-controller created\nserviceaccount/notification-controller created\nserviceaccount/source-controller created\nclusterrole.rbac.authorization.k8s.io/crd-controller-wego-system created\nclusterrolebinding.rbac.authorization.k8s.io/cluster-reconciler-wego-system created\nclusterrolebinding.rbac.authorization.k8s.io/crd-controller-wego-system created\nservice/notification-controller created\nservice/source-controller created\nservice/webhook-receiver created\ndeployment.apps/helm-controller created\ndeployment.apps/kustomize-controller created\ndeployment.apps/notification-controller created\ndeployment.apps/source-controller created\nnetworkpolicy.networking.k8s.io/allow-egress created\nnetworkpolicy.networking.k8s.io/allow-scraping created\nnetworkpolicy.networking.k8s.io/allow-webhooks created\ncustomresourcedefinition.apiextensions.k8s.io/apps.wego.weave.works created\n")),(0,i.kt)("ol",{start:4},(0,i.kt)("li",{parentName:"ol"},"Wait for Weave GitOps controllers to come online:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-console"},"kubectl get all --namespace wego-system\n")),(0,i.kt)("p",null,"You need to wait until all the controllers are running, e.g.:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"NAME                                       READY   STATUS    RESTARTS   AGE\nhelm-controller-69667f94bc-dhhtg           1/1     Running   0          52s\nkustomize-controller-6977b8cdd4-874n9      1/1     Running   0          52s\nnotification-controller-5c4d48f476-zf7kj   1/1     Running   0          52s\nsource-controller-b4b88948f-lk8rd          1/1     Running   0          52s\n")),(0,i.kt)("ol",{start:5},(0,i.kt)("li",{parentName:"ol"},"Fork the podinfo repository:\nFork the following repository on Github:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"https://github.com/stefanprodan/podinfo\n")),(0,i.kt)("ol",{start:6},(0,i.kt)("li",{parentName:"ol"},"Clone the fork using SSH:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"git clone git@github.com:<yr-org-goes-here>/podinfo.git\ncd podinfo\n")),(0,i.kt)("p",null,"(replace the ",(0,i.kt)("inlineCode",{parentName:"p"},"<yr-org-goes-here>")," with your own userid or organization)"),(0,i.kt)("p",null,"Take a quick look at the podinfo layout. There are multiple different directories with k8s deployment YAMLs.\nWe want to use the YAMLs in ",(0,i.kt)("inlineCode",{parentName:"p"},"deploy/webapp"),"."),(0,i.kt)("ol",{start:7},(0,i.kt)("li",{parentName:"ol"},"Configure Weave GitOps to deploy the repository")),(0,i.kt)("p",null,"We need to configure Weave GitOps to deploy the application from ",(0,i.kt)("inlineCode",{parentName:"p"},"deploy/webapp")," on branch ",(0,i.kt)("inlineCode",{parentName:"p"},"master")," of the repository at ",(0,i.kt)("inlineCode",{parentName:"p"},".")," using your private key"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-console"},"wego add . --path=deploy/webapp --branch=master  --private-key=<created private key file>\n")),(0,i.kt)("p",null,"You should see something like:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-console"},"Updating parameters from environment... using URL: 'ssh://git@github.com/pzfreo/podinfo.git' of origin from git config...\n\ndone\n\nChecking cluster status... FluxInstalled\n\n\u271a deploy key: ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIK9/sPRvz8t5sExOC/PAdiVKIX3g3rwh0q5f24djQ2T0\n\n\u25ba secret 'podinfo' created in 'wego-system' namespace\n---\napiVersion: source.toolkit.fluxcd.io/v1beta1\nkind: GitRepository\nmetadata:\n  name: podinfo\n  namespace: wego-system\nspec:\n  interval: 30s\n  ref:\n    branch: master\n  secretRef:\n    name: podinfo\n  url: ssh://git@github.com/pzfreo/podinfo.git\n\n---\napiVersion: kustomize.toolkit.fluxcd.io/v1beta1\nkind: Kustomization\nmetadata:\n  name: podinfo-dotwego-targets-kind-kind\n  namespace: wego-system\nspec:\n  interval: 5m0s\n  path: ./wego/targets/kind-kind\n  prune: true\n  sourceRef:\n    kind: GitRepository\n    name: podinfo\n  validation: client\n\n---\napiVersion: kustomize.toolkit.fluxcd.io/v1beta1\nkind: Kustomization\nmetadata:\n  name: podinfo-dotwego-apps-podinfo-deploy-webapp\n  namespace: wego-system\nspec:\n  interval: 5m0s\n  path: ./wego/apps/podinfo-deploy-webapp\n  prune: true\n  sourceRef:\n    kind: GitRepository\n    name: podinfo\n  validation: client\n\n---\napiVersion: kustomize.toolkit.fluxcd.io/v1beta1\nkind: Kustomization\nmetadata:\n  name: podinfo-deploy-webapp\n  namespace: wego-system\nspec:\n  interval: 5m0s\n  path: ./deploy/webapp\n  prune: true\n  sourceRef:\n    kind: GitRepository\n    name: podinfo\n  validation: client\n\nCommiting and pushing wego resources for application...\nPushing app manifests to repository\n")),(0,i.kt)("ol",{start:8},(0,i.kt)("li",{parentName:"ol"},"This will have created a ",(0,i.kt)("inlineCode",{parentName:"li"},".wego")," directory in your repository (you can configure where this goes - see ",(0,i.kt)("a",{parentName:"li",href:"/docs/gitops-automation"},"GitOps Automation configuration"),")")),(0,i.kt)("p",null,"This directory contains the GitOps Automation configuration. "),(0,i.kt)("p",null,"If you do a tree inside this directory you should see something like:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},".\n\u251c\u2500\u2500 apps\n\u2502\xa0\xa0 \u2514\u2500\u2500 podinfo-deploy-webapp\n\u2502\xa0\xa0     \u2514\u2500\u2500 app.yaml\n\u2514\u2500\u2500 targets\n    \u2514\u2500\u2500 kind-kind\n        \u2514\u2500\u2500 podinfo-deploy-webapp\n            \u2514\u2500\u2500 podinfo-deploy-webapp-gitops-runtime.yaml\n\n")),(0,i.kt)("p",null,"Notice that wego has automatically named the app ",(0,i.kt)("inlineCode",{parentName:"p"},"podinfo-deploy-webapp"),". You can change this with the ",(0,i.kt)("inlineCode",{parentName:"p"},"--name")," option."),(0,i.kt)("p",null,"You can find out more about these YAMLs ",(0,i.kt)("a",{parentName:"p",href:"/docs/gitops-automation"},"here"),"."),(0,i.kt)("ol",{start:8},(0,i.kt)("li",{parentName:"ol"},"Wait for the workload to show up in the cluster:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-console"},"kubectl get pods --namespace webapp\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"NAME                        READY   STATUS    RESTARTS   AGE\nbackend-5cd878f8dd-rl64h    1/1     Running   0          10m\nfrontend-86d5db4677-9twpt   1/1     Running   0          9m32s\n")),(0,i.kt)("ol",{start:9},(0,i.kt)("li",{parentName:"ol"},"You can use the ",(0,i.kt)("inlineCode",{parentName:"li"},"wego app status")," command to see the reconciliation:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-console"},"wego app status podinfo-deploy-webapp\n")),(0,i.kt)("p",null,"Latest successful deployment time: 2021-06-07T18:46:49Z\nNAMESPACE  \tNAME                               \tREADY\tMESSAGE                                                          \tREVISION                                       \tSUSPENDED\nwego-system\tkustomization/podinfo-deploy-webapp\tTrue \tApplied revision: master/a5023086275d2dbd79e2cbc6db1e626a1e846e59\tmaster/a5023086275d2dbd79e2cbc6db1e626a1e846e59\tFalse"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"\nThis shows you when the last deployment was as well as the specific SHA from Git that has been deployed.\n\nYou have successfully deployed the app!\n\n10. To access the `podinfo` UI you can set up a port forward into the pod.\n```console\nkubectl port-forward service/frontend 8000:80 --namespace webapp\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"Forwarding from 127.0.0.1:8000 -> 9898\nForwarding from [::1]:8000 -> 9898\n")),(0,i.kt)("p",null,"Now you can browse ",(0,i.kt)("a",{parentName:"p",href:"http://localhost:8000"},"`http://localhost:8000'")),(0,i.kt)("ol",{start:11},(0,i.kt)("li",{parentName:"ol"},"The real aim of GitOps is not just to deploy once, but to reconcile as well. Let's test that out.\nEdit ",(0,i.kt)("inlineCode",{parentName:"li"},"deploy/webapp/frontend/deployment.yaml"))),(0,i.kt)("p",null,"Change the ",(0,i.kt)("inlineCode",{parentName:"p"},"PODINFO_UI_COLOR")," to grey:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'        env:\n        - name: PODINFO_UI_COLOR\n          value: "#888888"\n')),(0,i.kt)("ol",{start:12},(0,i.kt)("li",{parentName:"ol"},"Commit the change to your forked repository.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'git add .\ngit commit -m "change color"\ngit push\n')),(0,i.kt)("ol",{start:13},(0,i.kt)("li",{parentName:"ol"},"Wait for the reconciliation to take place")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-console"},"wego app status podinfo-deploy-webapp\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"Latest successful deployment time: 2021-06-07T19:05:21Z\nNAMESPACE   NAME                                READY   MESSAGE                                                             REVISION                                        SUSPENDED\nwego-system kustomization/podinfo-deploy-webapp True    Applied revision: master/21e671e1b8794741ec3773e8a4e7ec4abb1e8ff5   master/21e671e1b8794741ec3773e8a4e7ec4abb1e8ff5 False\n")),(0,i.kt)("ol",{start:14},(0,i.kt)("li",{parentName:"ol"},"You should see the pods recycle ")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-console"},"kubectl get pods --namespace webapp\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"NAME                       READY   STATUS              RESTARTS   AGE\nbackend-5cd878f8dd-rl64h   1/1     Running             0          33m\nfrontend-5c45876f-pnxrq    1/1     Running             0          6m51s\nfrontend-ff74574fc-7ntw4   0/1     ContainerCreating   0          1s\n")),(0,i.kt)("p",null,"And a little later:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"NAME                       READY   STATUS        RESTARTS   AGE\nbackend-5cd878f8dd-rl64h   1/1     Running       0          34m\nfrontend-5c45876f-pnxrq    0/1     Terminating   0          7m9s\nfrontend-ff74574fc-7ntw4   1/1     Running       0          19s\n")),(0,i.kt)("p",null,"Notice that the backend has not changed and so the backend pod is not affected."),(0,i.kt)("p",null,"Restart the port forward and you will see the color has changed."),(0,i.kt)("ol",{start:12},(0,i.kt)("li",{parentName:"ol"},"Congratulations ")),(0,i.kt)("p",null,"You have successfully demonstrated GitOps using Weave GitOps! Well done."),(0,i.kt)("ol",{start:13},(0,i.kt)("li",{parentName:"ol"},"Next you might like to try using ",(0,i.kt)("a",{parentName:"li",href:"/docs/examples/helm"},"GitOps with Helm"))))}c.isMDXComponent=!0}}]);