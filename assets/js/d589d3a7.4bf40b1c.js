(self.webpackChunkweave_gitops_docs=self.webpackChunkweave_gitops_docs||[]).push([[162],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return p},kt:function(){return g}});var o=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,i=function(e,t){if(null==e)return{};var n,o,i={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=o.createContext({}),c=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},p=function(e){var t=c(e.components);return o.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=c(n),g=i,k=d["".concat(l,".").concat(g)]||d[g]||u[g]||r;return n?o.createElement(k,a(a({ref:t},p),{},{components:n})):o.createElement(k,a({ref:t},p))}));function g(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,a=new Array(r);a[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,a[1]=s;for(var c=2;c<r;c++)a[c]=n[c];return o.createElement.apply(null,a)}return o.createElement.apply(null,n)}d.displayName="MDXCreateElement"},601:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return a},metadata:function(){return s},toc:function(){return l},default:function(){return p}});var o=n(2122),i=n(9756),r=(n(7294),n(3905)),a={sidebar_position:2},s={unversionedId:"getting-started",id:"getting-started",isDocsHomePage:!1,title:"Getting Started",description:"Let's get an app deployed with Weave GitOps.",source:"@site/docs/getting-started.md",sourceDirName:".",slug:"/getting-started",permalink:"/docs/getting-started",editUrl:"https://github.com/weaveworks/weave-gitops-docs/edit/master/website/docs/getting-started.md",version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Installing the CLI",permalink:"/docs/installation"},next:{title:"CLI Reference",permalink:"/docs/cli-reference"}},l=[{value:"Overview",id:"overview",children:[]},{value:"Pre-requisites",id:"pre-requisites",children:[{value:"Github setup",id:"github-setup",children:[]},{value:"Install the CLI",id:"install-the-cli",children:[]}]},{value:"Getting Started Steps",id:"getting-started-steps",children:[]}],c={toc:l};function p(e){var t=e.components,n=(0,i.Z)(e,["components"]);return(0,r.kt)("wrapper",(0,o.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Let's get an app deployed with ",(0,r.kt)("strong",{parentName:"p"},"Weave GitOps"),"."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"This is Work In Progress")),(0,r.kt)("h3",{id:"overview"},"Overview"),(0,r.kt)("p",null,"In this short guide, we will see how to get a simple workload running in a cluster using GitOps, and then make a change to that deployment and see it updated automatically\nvia GitOps. Further guides will then show how to move that workload into staging and/or production. "),(0,r.kt)("h2",{id:"pre-requisites"},"Pre-requisites"),(0,r.kt)("p",null,"At the moment, Weave GitOps supports ",(0,r.kt)("a",{parentName:"p",href:"https://github.com"},"Github"),". ",(0,r.kt)("a",{parentName:"p",href:"https://gitlab.com"},"Gitlab")," and other Git providers are coming soon."),(0,r.kt)("p",null,"To get this working you need:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"A Github account "),(0,r.kt)("li",{parentName:"ol"},"A Github token and SSH key"),(0,r.kt)("li",{parentName:"ol"},"kubectl installed "),(0,r.kt)("li",{parentName:"ol"},"A development Kubernetes cluster (e.g. kind)")),(0,r.kt)("h3",{id:"github-setup"},"Github setup"),(0,r.kt)("p",null,"Please follow the ",(0,r.kt)("a",{parentName:"p",href:"https://docs.github.com/en/github/authenticating-to-github/connecting-to-github-with-ssh"},"Github SSH key setup guide")," if you don't already have an SSH key for Github."),(0,r.kt)("p",null,"You also need a Github Token with ",(0,r.kt)("inlineCode",{parentName:"p"},"repo")," access. Please follow the ",(0,r.kt)("a",{parentName:"p",href:"https://docs.github.com/en/github/authenticating-to-github/keeping-your-account-and-data-secure/creating-a-personal-access-token"},"Github guide")),(0,r.kt)("p",null,"Make sure that the token is in your environment as ",(0,r.kt)("inlineCode",{parentName:"p"},"GITHUB_TOKEN")),(0,r.kt)("h3",{id:"install-the-cli"},"Install the CLI"),(0,r.kt)("p",null,"Please follow the instructions in the  ",(0,r.kt)("a",{parentName:"p",href:"/docs/installation"},"CLI installation page")," to install the command-line tool."),(0,r.kt)("h2",{id:"getting-started-steps"},"Getting Started Steps"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"If necessary create a kind cluster:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"kind create cluster\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'Creating cluster "kind" ...\n \u2713 Ensuring node image (kindest/node:v1.20.2) \ud83d\uddbc\n \u2713 Preparing nodes \ud83d\udce6\n \u2713 Writing configuration \ud83d\udcdc\n \u2713 Starting control-plane \ud83d\udd79\ufe0f\n \u2713 Installing CNI \ud83d\udd0c\n \u2713 Installing StorageClass \ud83d\udcbe\nSet kubectl context to "kind-kind"\nYou can now use your cluster with:\n\nkubectl cluster-info --context kind-kind\n\nHave a nice day! \ud83d\udc4b\n')),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Install Weave GitOps into the cluster")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"wego install | kubectl apply -f -\n")),(0,r.kt)("p",null,"You should see:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"namespace/flux-system created\nnamespace/wego-system created\ncustomresourcedefinition.apiextensions.k8s.io/alerts.notification.toolkit.fluxcd.io created\ncustomresourcedefinition.apiextensions.k8s.io/buckets.source.toolkit.fluxcd.io created\ncustomresourcedefinition.apiextensions.k8s.io/gitrepositories.source.toolkit.fluxcd.io created\ncustomresourcedefinition.apiextensions.k8s.io/helmcharts.source.toolkit.fluxcd.io created\ncustomresourcedefinition.apiextensions.k8s.io/helmreleases.helm.toolkit.fluxcd.io created\ncustomresourcedefinition.apiextensions.k8s.io/helmrepositories.source.toolkit.fluxcd.io created\ncustomresourcedefinition.apiextensions.k8s.io/kustomizations.kustomize.toolkit.fluxcd.io created\ncustomresourcedefinition.apiextensions.k8s.io/providers.notification.toolkit.fluxcd.io created\ncustomresourcedefinition.apiextensions.k8s.io/receivers.notification.toolkit.fluxcd.io created\nserviceaccount/helm-controller created\nserviceaccount/kustomize-controller created\nserviceaccount/notification-controller created\nserviceaccount/source-controller created\nclusterrole.rbac.authorization.k8s.io/crd-controller-wego-system created\nclusterrolebinding.rbac.authorization.k8s.io/cluster-reconciler-wego-system created\nclusterrolebinding.rbac.authorization.k8s.io/crd-controller-wego-system created\nservice/notification-controller created\nservice/source-controller created\nservice/webhook-receiver created\ndeployment.apps/helm-controller created\ndeployment.apps/kustomize-controller created\ndeployment.apps/notification-controller created\ndeployment.apps/source-controller created\nnetworkpolicy.networking.k8s.io/allow-egress created\nnetworkpolicy.networking.k8s.io/allow-scraping created\nnetworkpolicy.networking.k8s.io/allow-webhooks created\ncustomresourcedefinition.apiextensions.k8s.io/apps.wego.weave.works created\n")),(0,r.kt)("ol",{start:4},(0,r.kt)("li",{parentName:"ol"},"Wait for Weave GitOps controllers to come online:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"kubectl get all --namespace wego-system\n")),(0,r.kt)("p",null,"You need to wait until all the controllers are running, e.g.:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"NAME                                       READY   STATUS    RESTARTS   AGE\nhelm-controller-69667f94bc-dhhtg           1/1     Running   0          52s\nkustomize-controller-6977b8cdd4-874n9      1/1     Running   0          52s\nnotification-controller-5c4d48f476-zf7kj   1/1     Running   0          52s\nsource-controller-b4b88948f-lk8rd          1/1     Running   0          52s\n")),(0,r.kt)("ol",{start:5},(0,r.kt)("li",{parentName:"ol"},"Fork the nginx repo:\nFork the following repository on Github:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"https://github.com/pzfreo/nginx\n")),(0,r.kt)("ol",{start:6},(0,r.kt)("li",{parentName:"ol"},"Clone the fork using SSH:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"git clone git@github.com:<yr-org-goes-here>/nginx.git\n")),(0,r.kt)("p",null,"(replace the ",(0,r.kt)("inlineCode",{parentName:"p"},"<yr-org-goes-here>")," with your own information)"),(0,r.kt)("ol",{start:7},(0,r.kt)("li",{parentName:"ol"},"Configure Weave GitOps to deploy the repository")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"cd nginx\nwego add . --private-key=<created private key file>\n")),(0,r.kt)("p",null,"You should see something like:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"Updating parameters from environment... using URL: 'ssh://git@github.com/pzfreo/nginx-fork.git' of origin from git config...\n\ndone\n\nChecking cluster status... FluxInstalled\n\n\u271a deploy key: ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIK9/sPRvz8t5sExOC/PAdiVKIX3g3rwh0q5f24djQ2T0\n\n\u25ba secret 'nginx-fork' created in 'wego-system' namespace\n---\napiVersion: source.toolkit.fluxcd.io/v1beta1\nkind: GitRepository\nmetadata:\n  name: nginx-fork\n  namespace: wego-system\nspec:\n  interval: 30s\n  ref:\n    branch: main\n  secretRef:\n    name: nginx-fork\n  url: ssh://git@github.com/pzfreo/nginx-fork.git\n\n---\napiVersion: kustomize.toolkit.fluxcd.io/v1beta1\nkind: Kustomization\nmetadata:\n  name: nginx-fork-dotwego-targets-kind-kind\n  namespace: wego-system\nspec:\n  interval: 5m0s\n  path: ./wego/targets/kind-kind\n  prune: true\n  sourceRef:\n    kind: GitRepository\n    name: nginx-fork\n  validation: client\n\n---\napiVersion: kustomize.toolkit.fluxcd.io/v1beta1\nkind: Kustomization\nmetadata:\n  name: nginx-fork-dotwego-apps-nginx-fork\n  namespace: wego-system\nspec:\n  interval: 5m0s\n  path: ./wego/apps/nginx-fork\n  prune: true\n  sourceRef:\n    kind: GitRepository\n    name: nginx-fork\n  validation: client\n\n---\napiVersion: kustomize.toolkit.fluxcd.io/v1beta1\nkind: Kustomization\nmetadata:\n  name: nginx-fork-dot\n  namespace: wego-system\nspec:\n  interval: 5m0s\n  path: ./\n  prune: true\n  sourceRef:\n    kind: GitRepository\n    name: nginx-fork\n  validation: client\n\nCommiting and pushing wego resources for application...\nPushing app manifests to repository\n")),(0,r.kt)("ol",{start:8},(0,r.kt)("li",{parentName:"ol"},"This will have created a ",(0,r.kt)("inlineCode",{parentName:"li"},".wego")," directory in your repository (you can configure where this goes - see ",(0,r.kt)("a",{parentName:"li",href:"/docs/gitops-automation"},"GitOps Automation configuration"),")")),(0,r.kt)("p",null,"This directory contains the GitOps Automation configuration. "),(0,r.kt)("p",null,"If you do a tree inside this directory you should see something like:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},".\n\u251c\u2500\u2500 apps\n\u2502\xa0\xa0 \u2514\u2500\u2500 nginx\n\u2502\xa0\xa0     \u2514\u2500\u2500 app.yaml\n\u2514\u2500\u2500 targets\n    \u2514\u2500\u2500 kind-kind\n        \u2514\u2500\u2500 nginx\n            \u2514\u2500\u2500 nginx-gitops-runtime.yaml\n\n5 directories, 2 files\n")),(0,r.kt)("p",null,"You can find out more about these YAMLs ",(0,r.kt)("a",{parentName:"p",href:"/docs/gitops-automation"},"here"),"."),(0,r.kt)("ol",{start:8},(0,r.kt)("li",{parentName:"ol"},"Wait for the workload to show up in the cluster:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"kubectl get pods --namespace my-nginx\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"NAME                     READY   STATUS    RESTARTS   AGE\nnginx-646c686cd6-brvsm   1/1     Running   0          1m38s\nnginx-646c686cd6-hsn6v   1/1     Running   0          1m38s\nnginx-646c686cd6-qgzf7   1/1     Running   0          1m38s\n")),(0,r.kt)("ol",{start:9},(0,r.kt)("li",{parentName:"ol"},"You can use the ",(0,r.kt)("inlineCode",{parentName:"li"},"wego app status")," command to see the reconciliation:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"NAME                READY   MESSAGE                                                         REVISION                                        SUSPENDED\ngitrepository/nginx True    Fetched revision: main/65ab909cee2a4f2c9727dd0eb9044dfee0aad7be main/65ab909cee2a4f2c9727dd0eb9044dfee0aad7be   False\n\nNAME                                            READY   MESSAGE                                                         REVISION                                        SUSPENDED\nkustomization/nginx-dot                         True    Applied revision: main/65ab909cee2a4f2c9727dd0eb9044dfee0aad7be main/65ab909cee2a4f2c9727dd0eb9044dfee0aad7be   False\nkustomization/nginx-dotwego-apps-nginx-fork     True    Applied revision: main/65ab909cee2a4f2c9727dd0eb9044dfee0aad7be main/65ab909cee2a4f2c9727dd0eb9044dfee0aad7be   False\nkustomization/nginx-dotwego-targets-kind-kind   True    Applied revision: main/65ab909cee2a4f2c9727dd0eb9044dfee0aad7be main/65ab909cee2a4f2c9727dd0eb9044dfee0aad7be   False\n")),(0,r.kt)("ol",{start:10},(0,r.kt)("li",{parentName:"ol"},"Try committing an update to the number of replicas to your forked repository:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"spec:\n  replicas: 4\n")),(0,r.kt)("ol",{start:11},(0,r.kt)("li",{parentName:"ol"},"Wait approximately 30s for the reconciliation to take place")),(0,r.kt)("p",null,"You should now see a 4th replica appear:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"kubectl get pods --namespace my-nginx\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"NAME                     READY   STATUS    RESTARTS   AGE\nnginx-646c686cd6-brvsm   1/1     Running   0          13m\nnginx-646c686cd6-gmxlz   1/1     Running   0          6s\nnginx-646c686cd6-hsn6v   1/1     Running   0          13m\nnginx-646c686cd6-qgzf7   1/1     Running   0          13m\n")),(0,r.kt)("ol",{start:12},(0,r.kt)("li",{parentName:"ol"},"Congratulations ")),(0,r.kt)("p",null,"You have successfully deployed GitOps! Well done."))}p.isMDXComponent=!0}}]);